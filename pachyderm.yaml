# Docker image
# Build a Docker image to deploy, run, or push to a container registry.
# Add steps that use Docker Compose, tag images, push to a registry, run an image, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/docker

pool:
  vmImage: "Ubuntu 16.04"

variables:
  imageName: $(dockerRegistry)/$(baseImageName):$(build.buildId)

steps:
  # - script: |
  #     apt update && apt install -y curl
  #     curl -o /tmp/pachctl.tar.gz -L https://github.com/pachyderm/pachyderm/releases/download/v1.7.10/pachctl_1.7.10_linux_amd64.tar.gz && tar -xvf /tmp/pachctl.tar.gz -C /tmp && sudo cp /tmp/pachctl_1.7.10_linux_amd64/pachctl /usr/local/bin
  #   displayName: "Install Pachyderm"

  - script: |
      sed -i 's/#$(baseImageName)#/imageName/g' hyper/pipelines/*.json
    displayName: "Replace Image Tags"

  - task: PublishBuildArtifacts@1
    displayName: "Publish Artifacts: drop"
